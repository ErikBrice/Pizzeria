<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}"
      lang="es">
<head>
    <title>Registro | La Pizzería</title>
</head>
<body>
    <!-- Contenido Principal -->
    <main layout:fragment="content" class="my-5">
        <div class="container">
            <!-- Alertas de mensajes -->
            <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-circle me-1"></i><span th:text="${success}">Registro exitoso.</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-circle me-1"></i> <span th:text="${error}">Error al registrarse.</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <div class="card shadow-sm">
                        <div class="card-header bg-dark text-white">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-user-plus me-2"></i>Crear una cuenta
                            </h5>
                        </div>
                        <div class="card-body p-4">
                            <form th:action="@{/registro}" method="post" th:object="${usuario}" class="needs-validation" novalidate>
                                
                                <!-- Nombre -->
                                <div class="mb-3">
                                    <label for="nombre" class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="nombre" name="nombre" th:field="*{nombre}" required autofocus>
                                    <div class="invalid-feedback">
                                        Por favor ingresa tu nombre.
                                    </div>
                                    <div class="text-danger" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></div>
                                </div>
                                
                                <!-- Apellido -->
                                <div class="mb-3">
                                    <label for="apellido" class="form-label">Apellido</label>
                                    <input type="text" class="form-control" id="apellido" name="apellido" th:field="*{apellido}" required>
                                    <div class="invalid-feedback">
                                        Por favor ingresa tu apellido.
                                    </div>
                                    <div class="text-danger" th:if="${#fields.hasErrors('apellido')}" th:errors="*{apellido}"></div>
                                </div>
                                
                                <!-- Correo electrónico -->
                                <div class="mb-3">
                                    <label for="correo" class="form-label">Correo electrónico</label>
                                    <input type="email" class="form-control" id="correo" name="correo" th:field="*{correo}" required>
                                    <div class="invalid-feedback">
                                        Por favor ingresa un correo electrónico válido.
                                    </div>
                                    <div class="text-danger" th:if="${#fields.hasErrors('correo')}" th:errors="*{correo}"></div>
                                </div>
                                
                                <!-- Teléfono -->
                                <div class="mb-3">
                                    <label for="telefono" class="form-label">Teléfono</label>
                                    <input type="tel"
                                           class="form-control"
                                           id="telefono"
                                           name="telefono"
                                           pattern="[0-9]{7,9}"
                                           maxlength="9"
                                           th:field="*{telefono}" required>
                                    <div class="invalid-feedback">
                                        Por favor ingresa un número de teléfono válido.
                                    </div>
                                    <div class="text-danger" th:if="${#fields.hasErrors('telefono')}" th:errors="*{telefono}"></div>
                                </div>
                                
                                <!-- Contraseña -->
                                <div class="mb-3">
                                    <label for="pwdUsuario" class="form-label">Contraseña</label>
                                    <input type="password" class="form-control" id="pwdUsuario" name="pwdUsuario" th:field="*{pwdUsuario}" required>
                                    <div class="invalid-feedback">
                                        Por favor ingresa una contraseña.
                                    </div>
                                    <div class="text-danger" th:if="${#fields.hasErrors('pwdUsuario')}" th:errors="*{pwdUsuario}"></div>
                                    <small class="form-text text-muted">La contraseña debe tener al menos 6 caracteres.</small>
                                </div>
                                
                                <!-- Confirmar contraseña -->
                                <div class="mb-3">
                                    <label for="confirmarPassword" class="form-label">Confirmar contraseña</label>
                                    <input type="password" class="form-control" id="confirmarPassword" name="confirmarPassword" required>
                                    <div class="invalid-feedback">
                                        Por favor confirma tu contraseña.
                                    </div>
                                </div>
                                
                                <!-- Términos y condiciones -->
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="terminos" name="terminos" required>
                                    <label class="form-check-label" for="terminos">
                                        Acepto los <a href="#" data-bs-toggle="modal" data-bs-target="#terminosModal">términos y condiciones</a>
                                    </label>
                                    <div class="invalid-feedback">
                                        Debes aceptar los términos y condiciones para continuar.
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-secondary">
                                        <i class="fas fa-user-plus me-1"></i> Registrarme
                                    </button>
                                </div>
                            </form>
                            
                            <div class="mt-3 text-center">
                                <p class="mb-0">¿Ya tienes una cuenta? <a th:href="@{/login}" class="text-muted">Inicia sesión aquí</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal de Términos y Condiciones -->
        <div class="modal fade" id="terminosModal" tabindex="-1" aria-labelledby="terminosModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="terminosModalLabel">Términos y Condiciones</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h6>1. Aceptación de los Términos</h6>
                        <p>Al registrarte en La Pizzería, aceptas estos términos y condiciones en su totalidad.</p>
                        
                        <h6>2. Uso del Servicio</h6>
                        <p>Nuestro servicio permite realizar pedidos de alimentos para entrega a domicilio. Debes proporcionar información precisa y mantener tus datos actualizados.</p>
                        
                        <h6>3. Cuentas de Usuario</h6>
                        <p>Eres responsable de mantener la confidencialidad de tu contraseña y de todas las actividades que ocurran bajo tu cuenta.</p>
                        
                        <h6>4. Pedidos y Pagos</h6>
                        <p>Al realizar un pedido, aceptas pagar el precio total indicado. Los tiempos de entrega son estimados y pueden variar según la demanda y condiciones.</p>
                        
                        <h6>5. Política de Privacidad</h6>
                        <p>Tu información personal será tratada conforme a nuestra Política de Privacidad, que forma parte integral de estos términos.</p>
                        
                        <h6>6. Modificaciones al Servicio</h6>
                        <p>Nos reservamos el derecho de modificar o interrumpir el servicio en cualquier momento, con o sin previo aviso.</p>
                        
                        <h6>7. Limitación de Responsabilidad</h6>
                        <p>No seremos responsables por daños indirectos, incidentales o consecuentes derivados del uso de nuestro servicio.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="aceptarTerminos">Aceptar</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts específicos -->
    <th:block layout:fragment="scripts">
        <!-- Script específico para el registro -->
        <script>
            // Función para marcar el checkbox de términos cuando se acepta en el modal
            document.getElementById('aceptarTerminos').addEventListener('click', function() {
                document.getElementById('terminos').checked = true;
            });
            
            // Validación del formulario
            (function() {
                'use strict';
                
                // Obtener el formulario
                let form = document.querySelector('.needs-validation');
                
                // Validar confirmación de contraseña
                let password = document.getElementById('pwdUsuario');
                let confirmPassword = document.getElementById('confirmarPassword');
                
                function validatePassword() {
                    if (password.value !== confirmPassword.value) {
                        confirmPassword.setCustomValidity('Las contraseñas no coinciden');
                    } else {
                        confirmPassword.setCustomValidity('');
                    }
                }
                
                // Eventos para validar contraseñas
                password.addEventListener('change', validatePassword);
                confirmPassword.addEventListener('keyup', validatePassword);
                
                // Evento de envío del formulario
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    
                    form.classList.add('was-validated');
                }, false);
            })();
        </script>
    </th:block>
    
</body>
</html>